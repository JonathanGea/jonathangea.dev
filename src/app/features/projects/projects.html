<section id="projects" class="py-16 bg-gray-50">
  <div class="h-12"></div>
  <div class="container mx-auto px-4">

    <!-- Filter -->
    <div class="mb-8 p-4 bg-white rounded-lg shadow-sm">
      <p class="text-sm text-gray-600 mb-3 text-left">
        Jelajahi proyek-proyek saya berdasarkan domain industri
      </p>
      <div class="flex flex-wrap justify-start gap-2">
        <button *ngFor="let domain of availableDomains" (click)="toggleDomain(domain)"
          [class.bg-black]="selectedDomains.includes(domain)" [class.text-white]="selectedDomains.includes(domain)"
          [class.bg-white]="!selectedDomains.includes(domain)"
          class="px-4 py-1.5 rounded-lg border border-gray-300 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-black">
          {{ domain }}
        </button>
      </div>
    </div>


    <!-- Grid Projects -->
    <div *ngIf="projects$ | async as projects" class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div *ngFor="let project of projects"
        class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-200 flex flex-col">

        <!-- Image Slider -->
        <div class="relative aspect-video overflow-hidden touch-none" (pointerdown)="onDragStart($event, project)"
          (pointermove)="onDragMove($event, project)" (pointerup)="onDragEnd($event, project)"
          (pointerleave)="onDragEnd($event, project)" (mouseenter)="pauseAutoSlide()" (mouseleave)="resumeAutoSlide()"
          tabindex="0" [attr.aria-label]="'Image carousel for ' + project.title">
          <div class="flex h-full transition-transform duration-500 ease-out"
            [style.transform]="'translateX(-' + (project.currentIndex * 100) + '%)'"
            [style.cursor]="isDragging(project) ? 'grabbing' : 'grab'">
            <div *ngFor="let image of project.images; let i = index" class="min-w-full h-full flex-shrink-0">
              <img [src]="image" [alt]="project.title + ' image ' + (i + 1)" class="w-full h-full object-cover"
                loading="lazy" draggable="false">
            </div>
          </div>

          <!-- Navigation Arrows -->
          <div *ngIf="project.images.length > 1" class="absolute inset-0 flex items-center justify-between px-2">
            <button (click)="prevImage(project, $event)" aria-label="Previous image"
              class="p-3 rounded-full bg-white shadow hover:bg-gray-100 transition-colors focus:outline-none">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                  d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                  clip-rule="evenodd" />
              </svg>
            </button>
            <button (click)="nextImage(project, $event)" aria-label="Next image"
              class="p-3 rounded-full bg-white shadow hover:bg-gray-100 transition-colors focus:outline-none">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd"
                  d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                  clip-rule="evenodd" />
              </svg>
            </button>
          </div>

          <!-- Domain Badge -->
          <span
            class="absolute bottom-4 left-4 bg-white text-gray-800 text-xs font-medium px-3 py-1 rounded-full shadow-sm">
            {{ project.domain }}
          </span>

          <!-- Slide Indicators -->
          <div *ngIf="project.images.length > 1" class="absolute bottom-4 right-4 flex gap-1.5">
            <button *ngFor="let img of project.images; let i = index" (click)="goToSlide(project, i, $event)"
              [attr.aria-label]="'Slide ' + (i + 1)"
              class="w-2 h-2 rounded-full transition-all duration-300 focus:outline-none"
              [class.bg-blue-600]="project.currentIndex === i" [class.bg-gray-300]="project.currentIndex !== i">
            </button>
          </div>
        </div>

        <!-- Info -->
        <div class="p-6 flex-1 flex flex-col">
          <div class="flex justify-between items-start mb-2">
            <h3 class="text-xl font-bold text-gray-900">{{ project.title }}</h3>
            <span *ngIf="project.year" class="text-sm text-gray-500">{{ project.year }}</span>
          </div>
          <p class="text-gray-600 mb-3 flex-1">{{ project.description }}</p>

          <div class="flex flex-wrap gap-2 mb-4">
            <span *ngFor="let tag of project.tags"
              class="text-xs font-medium bg-gray-100 text-gray-700 px-2.5 py-1 rounded-full whitespace-nowrap">
              {{ tag }}
            </span>
          </div>

          <div class="flex gap-3 mt-auto">
            <a *ngIf="project.livePreviewUrl" [href]="project.livePreviewUrl" target="_blank" class="flex-1 text-center px-4 py-2 text-sm font-medium 
          bg-black text-white rounded-lg 
          hover:bg-gray-900 transition-colors 
          focus:outline-none">
              Live Demo
            </a>

            <a *ngIf="project.caseStudyUrl" [href]="project.caseStudyUrl" target="_blank"
              class="flex-1 text-center px-4 py-2 text-sm font-medium border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors focus:outline-none">
              Case Study
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="(projects$ | async)?.length === 0" class="text-center py-16">
      <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
          d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <h3 class="mt-2 text-lg font-medium text-gray-900">No projects found</h3>
      <p class="mt-1 text-gray-500">Try adjusting your domain filters</p>
      <button (click)="selectedDomains = []; filterProjects()"
        class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors focus:outline-none">
        Reset Filters
      </button>
    </div>
  </div>
</section>